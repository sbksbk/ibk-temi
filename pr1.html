<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Î∞ïÏä§Ìòï Î∏îÎ°ù UI - ÌÖåÎØ∏ ÏãúÌÄÄÏä§ (Enhanced)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background-color: #f5f5f5; margin: 0; }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
    .controls button { padding: 10px 20px; background: #00acc1; color: white; border: none; border-radius: 8px; cursor: pointer; }
    .step-container { display: flex; flex-direction: column; gap: 10px; max-width: 800px; margin: auto; }
    .step { background: white; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); padding: 15px; position: relative; }
    .step-header { display: flex; justify-content: space-between; align-items: center; font-weight: bold; margin-bottom: 10px; cursor: move; }
    .block-row { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; }
    .block-col { background: #fafafa; border: 1px solid #ddd; border-radius: 8px; padding: 10px; position: relative; }
    .block-col label { display: block; margin-bottom: 5px; font-weight: bold; }
    .color-palette { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; }
    .swatch { width: 20px; height: 20px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
    .swatch.selected { border-color: #333; }
    .drop-zone { border: 2px dashed #ccc; padding: 10px; border-radius: 5px; text-align: center; color: #999; position: relative; cursor: pointer; }
    .drop-zone.dragover { background: #eef; }
    .preview { margin-top: 5px; font-size: 12px; color: #333; position: relative; }
    .preview img, .preview video, .preview audio { max-width: 100%; margin-top: 5px; display: block; }
    .clear-btn { position: absolute; top: 5px; right: 5px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 14px; line-height: 18px; text-align: center; }

    /* Simulation Modal Styles */
    #simulationArea {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        overflow: auto;
        padding: 0;
    }

    #simulationArea .simulation-content-wrapper {
        background-color: white;
        color: #333;
        padding: 0;
        border-radius: 10px;
        width: 60vw;
        height: 60vh;
        max-width: 95vw;
        max-height: 95vh;
        overflow: hidden;
        position: relative;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
         transition: all 0.3s ease;
    }

    #simulationArea .simulation-content-wrapper.is-fullscreen {
        width: 100vw !important;
        height: 100vh !important;
        max-width: 100vw !important;
        max-height: 100vh !important;
        border-radius: 0 !important;
        padding: 0 !important;
        background-color: black !important;
        justify-content: center !important;
        align-items: center !important;
    }


    #simulationArea .simulation-content {
        text-align: center;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        overflow: auto;
        padding: 20px;
    }


    #simulationArea img,
    #simulationArea video {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        margin: 0;
    }

    #simulationArea audio {
        margin-top: 20px;
    }

    #simulationArea .simulation-content p {
        margin: 0;
         word-break: break-word;
    }

    .close-simulation {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        font-size: 20px;
        cursor: pointer;
        z-index: 1001;
        display: flex;
        justify-content: center;
        align-items: center;
        line-height: 1;
    }

    .fullscreen-simulation {
        position: absolute;
        top: 10px;
        right: 50px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 5px 10px;
        font-size: 14px;
        cursor: pointer;
        z-index: 1001;
    }


    @keyframes blink { 50% { visibility: hidden; } }
    @keyframes typing { from { width: 0; } to { width: 100%; } }
    @keyframes slide-in { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .typing { overflow: hidden; white-space: nowrap; border-right: 2px solid; animation: typing 2s steps(20), blink .7s step-end infinite; }
    .slide { animation: slide-in 0.5s ease-out; }

     /* Added style for background color preview swatch */
    .bg-color-swatch-preview {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        border: 1px solid #ccc;
        margin-top: 5px;
        box-sizing: border-box;
    }

  </style>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&family=Nanum+Gothic&family=Roboto&display=swap" rel="stylesheet">
</head>
<body>
  <h1>üì¶ Î∞ïÏä§Ìòï Î∏îÎ°ù UI (Enhanced)</h1>
  <div class="controls">
    <button onclick="addStep()">+ Îã®Í≥Ñ Ï∂îÍ∞Ä</button>
    <button onclick="saveScenario()">ÏãúÎÇòÎ¶¨Ïò§ Ï†ÄÏû•</button>
    <button onclick="loadScenario()">ÏãúÎÇòÎ¶¨Ïò§ Î∂àÎü¨Ïò§Í∏∞</button>
    <button onclick="exportScenario()">JSON Îã§Ïö¥Î°úÎìú</button>
    <button onclick="startSimulation()">ÏãúÎÆ¨Î†àÏù¥ÏÖò ÏãúÏûë</button>
      <label for="repeatMode">Î∞òÎ≥µ:</label>
      <select id="repeatMode">
        <option value="infinite">Î¨¥Ìïú</option>
        <option value="1">1Î≤à</option>
        <option value="2">2Î≤à</option>
        <option value="3">3Î≤à</option>
        <option value="4">4Î≤à</option>
      </select>
  </div>
  <div id="stepContainer" class="step-container"></div>
  <div id="simulationArea">
      <div class="simulation-content-wrapper"> <button class="close-simulation" onclick="stopSimulation()">X</button>
           <button class="fullscreen-simulation" onclick="goFullscreen()">üì∫ Ï†ÑÏ≤¥ ÌôîÎ©¥ Î≥¥Í∏∞</button> <div class="simulation-content"></div>
      </div>
  </div>
  <div id="timeline"></div>

  <script>
    // Í∏∞Ï°¥ ÏΩîÎìú ÏÉùÎûµ (addStep, initPalette, initDropZones, initPreviews, updateSayPreview, updateShowPreview, updatePreview, deleteStep, updateStepNumbers, saveScenario, loadScenario, startSimulation, executeSimulationStep, stopSimulation, goFullscreen, exitFullscreen Îì±)

    // JSON Îã§Ïö¥Î°úÎìú Ìï®Ïàò Ï∂îÍ∞Ä
    function exportScenario() {
      const stepsData = [];
      document.querySelectorAll('.step').forEach(step => {
        const data = {
          sayText: step.querySelector('.say-text').value,
          saySize: parseInt(step.querySelector('.say-size').value),
          sayFont: step.querySelector('.say-font').value,
          textAnim: step.querySelector('.text-anim').value,
          sayColor: step.querySelector('.say-color-value').value,
          sayBold: step.querySelector('.say-bold').checked,
          sayBlink: step.querySelector('.say-blink').checked,
          showMedia: null,
          showBgColor: step.querySelector('.show-bg-color-value').value,
          audio: null,
          duration: parseInt(step.querySelector('.step-duration').value)
        };
        const imgInput = step.querySelector('.show-media');
        if (imgInput.files[0]) {
          data.showMedia = { name: imgInput.files[0].name, type: imgInput.files[0].type };
        }
        const audInput = step.querySelector('.audio-file');
        if (audInput.files[0]) {
          data.audio = { name: audInput.files[0].name, type: audInput.files[0].type };
        }
        stepsData.push(data);
      });
      const blob = new Blob([JSON.stringify(stepsData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'scenario.json';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
